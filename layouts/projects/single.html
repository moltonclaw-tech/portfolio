{{ define "main" }}
<article class="project-detail">
    
    {{/* Procedural Header - First image with vignette & title */}}
    {{ if and .Params.content (gt (len .Params.content) 0) }}
    {{ $first := index .Params.content 0 }}
    <header class="project-header">
        <div class="project-header-bg">
            {{ if eq $first.type "image" }}
            <img src="{{ $first.src }}" alt="{{ $.Title }}" class="project-header-image">
            {{ end }}
        </div>
        <div class="project-header-overlay"></div>
        <div class="project-header-fade"></div>
        <h1 class="project-header-title">{{ $.Title }}</h1>
    </header>
    {{ end }}

    <div class="project-content">

        {{/* Content - Images & Videos in specified order */}}
        {{ range .Params.content }}
            {{ if eq .type "image" }}
        <figure class="project-image">
            <img src="{{ .src }}" alt="{{ $.Title }}">
        </figure>
            {{ else if eq .type "video" }}
        <div class="project-video">
            {{ if hasPrefix .url "http" }}
                {{ if in .url "youtube.com" }}
                {{ $parts := split .url "/" }}
                {{ $videoId := index $parts (sub (len $parts) 1) }}
                <iframe src="https://www.youtube.com/embed/{{ $videoId }}" frameborder="0" allowfullscreen></iframe>
                {{ else if in .url "youtu.be" }}
                {{ $videoId := replace .url "https://youtu.be/" "" }}
                <iframe src="https://www.youtube.com/embed/{{ $videoId }}" frameborder="0" allowfullscreen></iframe>
                {{ else if in .url "vimeo.com" }}
                {{ $parts := split .url "/" }}
                {{ $videoId := index $parts (sub (len $parts) 1) }}
                <iframe src="https://player.vimeo.com/video/{{ $videoId }}" frameborder="0" allowfullscreen></iframe>
                {{ else }}
                <video controls>
                    <source src="{{ .url }}" type="video/mp4">
                </video>
                {{ end }}
            {{ else }}
            <video controls>
                <source src="{{ .url | relURL }}" type="video/mp4">
            </video>
            {{ end }}
        </div>
            {{ end }}
        {{ end }}

        {{/* Project Info */}}
        <aside class="project-info">
            <h1 class="project-title">{{ .Title }}</h1>

            {{ with .Description }}
            <p class="project-description">{{ . | markdownify }}</p>
            {{ end }}

            <div class="project-meta">
                {{ with .Params.year }}
                <div class="meta-item">
                    <span class="meta-label">Year</span>
                    <span class="meta-value">{{ . }}</span>
                </div>
                {{ end }}
            </div>

            {{ with .Params.tools }}
            <div class="project-tools">
                <h3>Tools Used</h3>
                <ul class="tools-list">
                    {{ range . }}
                    <li>{{ . }}</li>
                    {{ end }}
                </ul>
            </div>
            {{ end }}
        </aside>

    </div>

    <nav class="project-nav">
        {{ with .PrevInSection }}
        <a href="{{ .Permalink }}" class="nav-prev">&larr; {{ .Title }}</a>
        {{ end }}
        {{ with .NextInSection }}
        <a href="{{ .Permalink }}" class="nav-next">{{ .Title }} &rarr;</a>
        {{ end }}
    </nav>
</article>
{{ end }}
