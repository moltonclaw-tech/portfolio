{{ define "main" }}
<section class="gallery-container">
    {{ $allProjects := where site.Pages "Section" "projects" }}
    {{ $projects := where $allProjects "Title" "!=" "Projects" }}
    {{ $sorted := sort $projects "Params.importance" "desc" }}
    {{ $sorted = sort $sorted "Params.order" "asc" }}
    
    {{ range $sorted }}
    {{ $spanClass := "span-1" }}
    {{ if eq .Params.importance 2 }}{{ $spanClass = "span-2" }}{{ end }}
    {{ if eq .Params.importance 3 }}{{ $spanClass = "span-3" }}{{ end }}
    {{ if eq .Params.importance 4 }}{{ $spanClass = "span-4" }}{{ end }}
    {{ if eq .Params.importance 6 }}{{ $spanClass = "span-6" }}{{ end }}
    
    {{ if eq .Params.importance 1 }}
    <div class="project-card {{ $spanClass }} importance-1" data-image="/thumbs/{{ .Params.thumbnail }}">
        <div class="project-thumb">
            <img src="/thumbs/{{ .Params.thumbnail }}" alt="{{ .Title }}">
            <div class="project-overlay">
                <h3 class="project-title">{{ .Title }}</h3>
            </div>
        </div>
    </div>
    {{ else }}
    <a href="{{ .RelPermalink }}" class="project-card {{ $spanClass }}" data-importance="{{ .Params.importance }}">
        <div class="project-thumb">
            <img src="/thumbs/{{ .Params.thumbnail }}" alt="{{ .Title }}">
            <div class="project-overlay">
                <h3 class="project-title">{{ .Title }}</h3>
            </div>
        </div>
    </a>
    {{ end }}
    {{ end }}
    
    <!-- Studies images -->
    {{ $studies := resources.Match "studies/*" }}
    {{ range $studies }}
    {{ $name := path.Base .Name }}
    {{ $name = replaceRE "\\..*" "" $name }}
    <div class="project-card span-1 importance-1" data-image="{{ .RelPermalink }}">
        <div class="project-thumb">
            <img src="{{ .RelPermalink }}" alt="{{ $name }}">
            <div class="project-overlay">
                <h3 class="project-title">{{ $name }}</h3>
            </div>
        </div>
    </div>
    {{ end }}
</section>

<!-- Lightbox for importance 1 projects -->
<div id="lightbox" class="lightbox">
    <button class="lightbox-close">&times;</button>
    <img id="lightbox-image" src="" alt="">
</div>
{{ end }}
